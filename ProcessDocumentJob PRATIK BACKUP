public class ProfitAndLossSaverJob implements Queueable {

    private String detailsString;

    public ProfitAndLossSaverJob(String detailsString) {
        this.detailsString = detailsString;
    }

    public void execute(QueueableContext context) {
        System.debug('Starting execute with detailsString: ' + detailsString);
        insertNewProfitAndLossRecord(detailsString);
    }

    private void insertNewProfitAndLossRecord(String detailsString) {
        System.debug('insertNewProfitAndLossRecord called with detailsString: ' + detailsString);

        if (String.isBlank(detailsString)) {
            System.debug('No details provided!');
            return;
        }

        Profit_and_Loss__c newRecord = new Profit_and_Loss__c();
        System.debug('Created new Profit_and_Loss__c record');

        Map<String, String> fieldMap = new Map<String, String>{
            'Borrower Name' => 'Borrower_Name_s__c',
            'Company Name' => 'Name',
            'Loan Number' => 'Loan_Number__c',
            'Type of Business' => 'Type_of_Bussiness__c'
        };

        for (String key : fieldMap.keySet()) {
            System.debug('Looking for key: ' + key);
            Pattern p = Pattern.compile(key + '[^}]*value=([^,}]*)');
            Matcher m = p.matcher(detailsString);
            if (m.find()) {
                String value = m.group(1).trim();
                System.debug('Matched key: ' + key + ', value: ' + value);

                // Set field accordingly
                if (fieldMap.get(key) == 'Borrower_Name_s__c') {
                    newRecord.Borrower_Name_s__c = value;
                    System.debug('Set Borrower_Name_s__c');
                } else if (fieldMap.get(key) == 'Name') {
                    newRecord.Name = value;
                    System.debug('Set Name');
                } else if (fieldMap.get(key) == 'Loan_Number__c') {
                    // newRecord.Loan_Number__c = value.replaceAll('\\D', '');
                    System.debug('Set Loan_Number__c');
                } else if (fieldMap.get(key) == 'Type_of_Bussiness__c') {
                    newRecord.Type_of_Bussiness__c = value;
                    System.debug('Set Type_of_Bussiness__c');
                }
            } else {
                System.debug('Key not found: ' + key);
            }
        }

        try {
            insert newRecord;
            System.debug('Inserted Profit_and_Loss__c record with Id: ' + newRecord.Id);
        } catch (Exception e) {
            System.debug('Failed to insert: ' + e.getMessage());
        }
    }
}
